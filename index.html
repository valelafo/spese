        <!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Budget Mobile</title>
    <style>
        :root { --primary: #1a1a1a; --accent: #007bff; --success: #28a745; --bg: #f0f2f5; --card-bg: #ffffff; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: var(--bg); 
            margin: 0; padding: 10px; 
            color: var(--primary);
        }

        .container { max-width: 500px; margin: 0 auto; }

        /* Card Anno - Pi√π visibile */
        .year-header {
            background: var(--primary);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .year-header select {
            background: white;
            font-size: 18px;
            padding: 8px 20px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            margin-top: 10px;
            width: 80%;
        }

        /* Sezione Input */
        .form-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);
            margin-bottom: 15px;
        }

        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; color: #666; }
        
        input, select {
            width: 100%;
            height: 48px; /* Altezza ottimale per touch */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px; /* Evita lo zoom automatico su iPhone */
            box-sizing: border-box;
            background-color: #f9f9f9;
        }

        button {
            width: 100%;
            height: 54px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s;
        }
        
        button:active { transform: scale(0.98); }

        /* Box Media - Molto evidente */
        .stats-card {
            background: #e7f3ff;
            border: 2px solid var(--accent);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .avg-label { font-size: 14px; text-transform: uppercase; letter-spacing: 1px; color: var(--accent); font-weight: bold; }
        .avg-value { font-size: 36px; font-weight: 800; margin: 5px 0; color: var(--primary); }
        .total-label { font-size: 14px; color: #555; }

        /* Lista Storico */
        .history-section { margin-top: 20px; }
        .item-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid var(--accent);
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }

        .item-info div:first-child { font-weight: bold; font-size: 15px; }
        .item-info div:last-child { font-size: 12px; color: #888; margin-top: 3px; }
        
        .item-price { text-align: right; }
        .price { font-weight: 800; font-size: 16px; display: block; }
        .btn-del {
            color: #ff4d4d;
            background: #fff0f0;
            border: none;
            padding: 5px 12px;
            border-radius: 8px;
            margin-top: 5px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="year-header">
        <div>ANNO DI RIFERIMENTO</div>
        <select id="filter-year" onchange="update()">
            <option value="2025">2025</option>
            <option value="2026" selected>2026</option>
            <option value="2027">2027</option>
        </select>
    </div>

    <div class="form-card">
        <div class="input-group">
            <label>Cosa hai comprato?</label>
            <input type="text" id="desc" placeholder="es. Spesa Esselunga">
        </div>
        
        <div class="input-group">
            <label>Categoria</label>
            <select id="cat">
                <option value="Viaggi">‚úàÔ∏è Viaggi</option>
                <option value="Svago">üçø Svago</option>
                <option value="Casalinghi">üè† Casalinghi</option>
                <option value="Oggetti">üì¶ Oggetti</option>
                <option value="Veicoli">üöó Veicoli</option>
                <option value="Investimenti">üìà Investimenti</option>
            </select>
        </div>

        <div style="display: flex; gap: 10px;">
            <div class="input-group" style="flex: 2;">
                <label>Importo (‚Ç¨)</label>
                <input type="number" id="val" step="0.01" placeholder="0.00">
            </div>
            <div class="input-group" style="flex: 2;">
                <label>Data</label>
                <input type="date" id="data-input">
            </div>
        </div>

        <button onclick="add()">REGISTRA ORA</button>
    </div>

    <div class="stats-card">
        <div class="avg-label">Media Mensile 1/12</div>
        <div class="avg-value" id="avg-total">‚Ç¨0.00</div>
        <div class="total-label">Totale Anno: <span id="y-total" style="font-weight: bold;">‚Ç¨0.00</span></div>
    </div>

    <div class="history-section" id="history">
        </div>
</div>

<script>
    let spese = JSON.parse(localStorage.getItem('registro_mobile_v1')) || [];
    document.getElementById('data-input').valueAsDate = new Date();

    function update() {
        const selectedYear = parseInt(document.getElementById('filter-year').value);
        const hist = document.getElementById('history');
        hist.innerHTML = '';
        let totaleAnno = 0;

        spese.slice().reverse().forEach((item, index) => {
            const dataSpesa = new Date(item.data);
            if(dataSpesa.getFullYear() === selectedYear) {
                const importo = parseFloat(item.v);
                totaleAnno += importo;

                const realIndex = spese.length - 1 - index;
                hist.innerHTML += `
                    <div class="item-card">
                        <div class="item-info">
                            <div>${item.d}</div>
                            <div>${item.c} ‚Ä¢ ${dataSpesa.toLocaleDateString('it-IT')}</div>
                        </div>
                        <div class="item-price">
                            <span class="price">‚Ç¨${importo.toFixed(2)}</span>
                            <button class="btn-del" onclick="del(${realIndex})">Elimina</button>
                        </div>
                    </div>`;
            }
        });

        document.getElementById('y-total').innerText = '‚Ç¨' + totaleAnno.toFixed(2);
        document.getElementById('avg-total').innerText = '‚Ç¨' + (totaleAnno / 12).toFixed(2);
        localStorage.setItem('registro_mobile_v1', JSON.stringify(spese));
    }

    function add() {
        const d = document.getElementById('desc').value;
        const c = document.getElementById('cat').value;
        const v = document.getElementById('val').value;
        const dt = document.getElementById('data-input').value;
        
        if(d && v && dt) {
            spese.push({ d, c, v, data: dt });
            document.getElementById('desc').value = '';
            document.getElementById('val').value = '';
            update();
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }
    }

    function del(i) {
        if(confirm("Eliminare questa spesa?")) {
            spese.splice(i, 1);
            update();
        }
    }

    update();
</script>

</body>
</html>
